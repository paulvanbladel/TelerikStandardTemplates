@page "/"

@using TelerikDashboard.Shared.Models
@using TelerikDashboard.Client.Services
@using TelerikDashboard.Client.Components.Tiles
@using System.Threading

@inject DashboardDataService _dataService

@using Telerik.Blazor.Services
@* You can use the service for Telerik localization for your own code as well - for example the grid command buttons *@
@inject ITelerikStringLocalizer Localizer
@* This is the namespace that is generated from the resx files localizer *@
@using TelerikDashboard.Shared.Resources

<div style="margin-left: 20px">
    Current UI culture (used for localization): @Thread.CurrentThread.CurrentUICulture.Name
    <br />
    Current thread culture (used for date and number formatting): @Thread.CurrentThread.CurrentCulture.Name
    <br />
</div>

<div class="d-flex justify-content-center">
    <TelerikTileLayout Columns="4"
                       RowHeight="145px"
                       ColumnWidth="350px"
                       Reorderable="true"
                       Resizable="true"
                       OnResize="@ResizeCharts">
        <TileLayoutItems>
            <TileLayoutItem HeaderText="Total Streams">
                <Content>
                    <TotalStreams />
                </Content>
            </TileLayoutItem>
            <TileLayoutItem HeaderText="Total Downloads">
                <Content>
                    <TotalDownloads />
                </Content>
            </TileLayoutItem>
            <TileLayoutItem HeaderText="Reach">
                <Content>
                    <TotalReach />
                </Content>
            </TileLayoutItem>
            <TileLayoutItem HeaderText="Revenue">
                <Content>
                    <TotalRevenue />
                </Content>
            </TileLayoutItem>
            <TileLayoutItem HeaderText="Weekly Recap-Downloads" ColSpan="2" RowSpan="2">
                <Content>
                    <WeeklyRecap Podcasts="@Podcasts" @ref="@WeeklyRecap" />
                </Content>
            </TileLayoutItem>
            <TileLayoutItem HeaderText="Performance Trend" ColSpan="2" RowSpan="2">
                <Content>
                    <PerformanceTrend Podcasts="@Podcasts" @ref="@PerformanceTrend" />
                </Content>
            </TileLayoutItem>
            <TileLayoutItem HeaderText="Top 5 Episodes" ColSpan="4" RowSpan="2">
                <Content>
                    <TopEpisodes TopN="5" Podcasts="@Podcasts" />
                </Content>
            </TileLayoutItem>
            <TileLayoutItem HeaderText="Listening platforms - App" ColSpan="2" RowSpan="2">
                <Content>
                    <PlatformsChart @ref="@AppBreakdown" />
                </Content>
            </TileLayoutItem>
            <TileLayoutItem HeaderText="Listening platforms - Device" ColSpan="2" RowSpan="2">
                <Content>
                    <PlatformsChart ByDevice="true" @ref="@DeviceBreakdown" />
                </Content>
            </TileLayoutItem>
        </TileLayoutItems>
    </TelerikTileLayout>
</div>

@code{
    IEnumerable<PodcastViewModel> Podcasts { get; set; }
    WeeklyRecap WeeklyRecap { get; set; }
    PerformanceTrend PerformanceTrend { get; set; }
    PlatformsChart DeviceBreakdown { get; set; }
    PlatformsChart AppBreakdown { get; set; }

    protected override async Task OnInitializedAsync()
    {
        Podcasts = await _dataService.GetPodcasts();
    }

    void ResizeCharts()
    {
        WeeklyRecap.Resize();
        PerformanceTrend.Resize();
        DeviceBreakdown.Resize();
        AppBreakdown.Resize();
    }
}
